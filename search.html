<!-- REPLACE your existing search form with this (homepage search works without a separate page) -->
<form id="site-search" role="search" aria-label="Search government jobs" class="mt-4 flex flex-col sm:flex-row gap-3">
  <label for="q" class="sr-only">Search jobs</label>
  <input id="q" name="q" type="search"
         placeholder="Search: SSC CGL, RRB NTPC, IBPS PO, Police, Teaching..."
         class="w-full sm:flex-1 px-4 py-3 rounded-md border border-slate-200 focus:outline-none focus:ring-2 focus:ring-sky-300"
         autocomplete="off" />
  <button type="submit" class="px-5 py-3 rounded-md bg-sky-600 text-white font-semibold hover:bg-sky-700 transition">
    Search
  </button>
</form>

<!-- ADD this results container right below the form (homepage results) -->
<section id="search-results" class="mt-4 hidden" aria-live="polite">
  <div class="bg-white border border-slate-200 rounded-lg p-4">
    <div class="flex items-center justify-between gap-3">
      <h3 class="text-lg font-bold text-slate-900">Search results</h3>
      <button type="button" id="clear-search"
              class="text-sm px-3 py-1.5 rounded-md border border-slate-200 hover:bg-slate-50">
        Clear
      </button>
    </div>
    <p id="search-status" class="text-sm text-slate-600 mt-2"></p>
    <ul id="search-list" class="mt-3 space-y-2"></ul>
    <p class="text-xs text-slate-500 mt-3">
      Tip: This searches links already visible on the homepage (jobs, sections, tools). Always verify details on official sources.
    </p>
  </div>
</section>

<!-- ADD this script near the bottom of index.html, BEFORE </body> and AFTER script.js -->
<script>
(function () {
  const form = document.getElementById("site-search");
  const input = document.getElementById("q");
  const wrap = document.getElementById("search-results");
  const status = document.getElementById("search-status");
  const list = document.getElementById("search-list");
  const clearBtn = document.getElementById("clear-search");

  function escapeHtml(s) {
    return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }

  function getSearchableLinks() {
    // Collect ALL internal links currently on the page (including ones injected by script.js)
    const anchors = Array.from(document.querySelectorAll("a[href]"));
    const out = [];
    const seen = new Set();

    for (const a of anchors) {
      const href = a.getAttribute("href") || "";
      // ignore empty, hashes, mailto/tel, external
      if (!href || href.startsWith("#") || href.startsWith("mailto:") || href.startsWith("tel:")) continue;
      if (/^https?:\/\//i.test(href) && !href.includes(location.hostname)) continue;

      const text = (a.textContent || "").trim();
      const key = href + "|" + text;
      if (!text || text.length < 2) continue;
      if (seen.has(key)) continue;
      seen.add(key);

      out.push({ href, text });
    }
    return out;
  }

  function renderResults(query, results) {
    wrap.classList.remove("hidden");
    if (!results.length) {
      status.textContent = `No results found for “${query}”. Try SSC, Railway, Bank, Police, Admit Card, Result.`;
      list.innerHTML = "";
      return;
    }

    status.textContent = `Showing ${results.length} result(s) for “${query}”.`;
    list.innerHTML = results.slice(0, 30).map(r => {
      return `
        <li class="border border-slate-200 rounded-md p-3 hover:bg-slate-50 transition">
          <a class="font-semibold text-sky-700 underline underline-offset-2" href="${escapeHtml(r.href)}">
            ${escapeHtml(r.text)}
          </a>
          <div class="text-xs text-slate-500 mt-1">${escapeHtml(r.href)}</div>
        </li>
      `;
    }).join("");
  }

  function clearResults() {
    input.value = "";
    wrap.classList.add("hidden");
    status.textContent = "";
    list.innerHTML = "";
    input.focus();
  }

  // Wait a bit so your existing script.js can inject job links first
  function doSearch(query) {
    const q = query.trim().toLowerCase();
    if (!q) {
      renderResults(query, []);
      return;
    }
    const links = getSearchableLinks();
    const matches = links.filter(l => (l.text + " " + l.href).toLowerCase().includes(q));
    renderResults(query, matches);
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    // ensure dynamic content is loaded (if still loading, search after a short delay)
    doSearch(input.value);
  });

  clearBtn.addEventListener("click", clearResults);

  // Optional: live search after user stops typing
  let t = null;
  input.addEventListener("input", function () {
    clearTimeout(t);
    t = setTimeout(() => {
      if (input.value.trim().length >= 2) doSearch(input.value);
      if (!input.value.trim()) wrap.classList.add("hidden");
    }, 250);
  });
})();
</script>
